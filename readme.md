# Twitch бот для игры Heroes of Storm.

Функционал:
* Выводит информацию о лобби во время загрузки матча (батлтеги, уровни аккаунтов, состоят ли в группе)
* Выводит выбранные таланты прямо во время матча (при  доступе к загрузке изображений по FTP)
* Расширенная послематчевая статистика
* Послематчевый список талантов
* Результаты сыгранных матчей за день

Сохранённые изображения публикуются на Imgur или на FTP.

Для запуска необходимо:
* Установить [Python3](https://www.python.org/downloads/)

* Установить зависимости (вводить в командную строку)
```bash
py -m pip install configobj imgurpython Pillow mpyq twitchio
```

* Установить heroprotocol

Установить heroprotocol можно из [официального репозитория Blizzard](https://github.com/Blizzard/heroprotocol), но в этом случае, потребуется устанавливать устаревшую (начиная с python 3.12) библиотеку `imp.py`. Получить устаревшую библиотеку можно где-то в интернете, либо скачав `python < 3.12` и скопировав оттуда файл `python\Lib\imp.py` в такую же директорию актуального питона.

Если Вы не хотите устанавливать отдельно устаревшую библиотеку, то можно скачать heroprotocol из моего форка с правками под актуальную версию питона:
```bash
py -m pip install -U git+https://github.com/MrMalina/heroprotocol
```

* Скачать [архив с ботом](https://github.com/MrMalina/httshots/archive/refs/heads/master.zip)

* Разархивировать архив с ботом в директорию, где установлен python. Например: d:\python\

* Заполнить конфигурационный файл

Конфигурационный файл находится в `./httshots/config/config.ini`

* Запустить бота
Если директорию с файлами бота располагается в той же директории, где python, то запуск осуществляется командой:
```bash
py -m httshots
```

Для запуска бота с параметрами:
```bash
py -m httshots ПАРАМЕТРЫ
```

Список параметров:
* IGNORE_PREV_MATCHES - при запуске бота НЕ учитывать ранее сыгранные сегодня матчи.Приоритет выше, чем параметр add_previous_games в конфигурационном файле
* SEND_BATTLE_LOBBY - при запуске бота выводить информацию о лобби, если её можно получить. Приоритет выше, чем параметр send_previous_battle_lobby в конфигурационном файле
* RU_REPLAY - язык реплея русский. Приоритет выше, чем параметр replay_language в конфигурационном файле
* EN_REPLAY - язык реплея английский. Приоритет выше, чем параметр replay_language в конфигурационном файле
* URL_TO_CONSOLE - дублировать все ссылки в консоль. Приоритет выше, чем параметр send_url_to_console в конфигурационном файле

Например, чтобы запустить бота с игнорированием предыдущих матчей и дублированием ссылок в консоль:
```bash
py -m httshots IGNORE_PREV_MATCHES URL_TO_CONSOLE
```

Внимание, при использовании Imgur актуальные таланты не будут публиковаться!

# Подключение FTP
Для отображения талантов прямо из матча, создайте в директории `config::site_name/config::ftp_folder/` директорию `curname`.
Итого должно получиться, например: `/httshots.ru/mln/curgame.`
Перенесите в эту директорию файл `index.html` из директории `httshots/files/`
Файл `index.html` сгенерирован через генеративную сеть искусственного интеллекта.

# Благодарности
* С помощью приложения CascView извлечены файлы из хотса
* Файл с информацией о героях (herodata.json) получен с помощью [HeroesDataParser](https://github.com/HeroesToolChest/HeroesDataParser)

# Список команд в twitch-чате
Ниже представлен список команд, которые доступны в чате трансляции, где активен бот.

`!game <[cmd]> <[param]>` - команда позволяет вывести информацию о прошлом сыгранном матче. Аналог команды на русском - `!матч`

`!game` без параметров - результат последнего сыгранного матча

`!game score` или `!матч счёт` - уровни команд и количество убийств

`!game bans` или `!матч баны` - список забаненных персонажей. Имена персонажей указываются так, как применимы в реплее игры

`!game heroes` или `!матч герои` - список персонажей в матче

`!game <hero>` - таланты, которые были взяты у персонажа

`!game <hero> score` или `!матч <персонаж> счёт` - итоговый KDA

`!game <hero> <параметр>` - значение указанного параметра, если он будет обнаружен. Список параметров можно посмотреть, например, [тут](https://raw.githubusercontent.com/MrMalina/hots-replays-params/refs/heads/master/replay.ini)

`!games` или `!матчи` - результаты сыгранных матчей

`!talents <hero>` или `!таланты <персонаж>` - таланты персонажа в текущем матче. Таланты публикуются с задержкой в ~1 минуту
`!game <hero> score` или `!матч <персонаж> счёт` - итоговый KDA
`!game <hero> <параметр>` - значение указанного параметра, если он будет обнаружен. Список параметров можно посмотреть, например, [тут](https://raw.githubusercontent.com/MrMalina/hots-replays-params/refs/heads/master/replay.ini)
`!games` или `!матчи` - результаты сыгранных матчей
`!talents <hero>` или `!таланты <персонаж>` - таланты персонажа в текущем матче. Таланты публикуются с задержкой в ~1 минуту
